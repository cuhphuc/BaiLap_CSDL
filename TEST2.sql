CREATE DATABASE QLDIEM;
USE QLDIEM;

CREATE TABLE MONHOC
(
MAMON varchar(20) not null,
TENMON nvarchar(50) not null,
SOTC int not null
);
ALTER TABLE MONHOC 
ADD CONSTRAINT MAMON_pk PRIMARY KEY (MAMON);

CREATE TABLE DIEM
(
MASV varchar(20) not null,
MAMON varchar(20) not null,
DIEMTHI FLOAT not null
);
ALTER TABLE DIEM
ADD CONSTRAINT MASV_fk FOREIGN KEY (MASV) REFERENCES SINHVIEN (MASV);
ALTER TABLE DIEM
ADD CONSTRAINT MAMON_fk FOREIGN KEY (MAMON) REFERENCES MONHOC (MAMON);

CREATE TABLE SINHVIEN
(
MASV varchar(20) not null,
HOTEN varchar(30) not null,
NGAYSINH DATE not null
);
ALTER TABLE SINHVIEN
ADD CONSTRAINT MASV_pk PRIMARY KEY (MASV);

INSERT INTO MONHOC VALUES ('A01', 'ANH', 2);
INSERT INTO MONHOC VALUES ('A02', 'TOAN', 3);
INSERT INTO MONHOC VALUES ('A03', 'VAN', 3);

INSERT INTO DIEM VALUES ('SV01', 'A01', 7);
INSERT INTO DIEM VALUES ('SV02', 'A01', 8.5);
INSERT INTO DIEM VALUES ('SV01', 'A02', 9);
INSERT INTO DIEM VALUES ('SV03', 'A03', 7.5);
INSERT INTO DIEM VALUES ('SV02', 'A02', 7);

INSERT INTO SINHVIEN VALUES ('SV01', 'TRƯƠNG THANH PHUC', CAST(27-02-2002 AS DATE)) ;
INSERT INTO SINHVIEN VALUES ('SV02', 'TRỊNH HOÀNG VIỆT', CAST(09-07-2002 AS DATE)) ;
INSERT INTO SINHVIEN VALUES ('SV03', 'TRẦN NGUYÊN LUÂN', CAST(01-02-2002 AS DATE)) ;

SELECT * FROM MONHOC;
SELECT * FROM DIEM;
SELECT * FROM SINHVIEN;


-- ------CÂU2

CREATE FUNCTION TKSV (@TMH NVARCHAR(20))
RETURNS INT
AS
BEGIN
 DECLARE @DEM INT
 SET @DIEM_SV = (SELECT COUNT(*)
 FROM DIEM
WHERE @DIEM_SV <5)
 RETURN @DIEM_SV
END
GO
SELECT DBO.TKSV ('ANH')

-- -------CÂU3
CREATE PROCEDURE nhapdiem (@masv CHAR(10), @mamon CHAR(10), @diemthi FLOAT)
AS
BEGIN
	INSERT INTO DIEM (MASV, MAMON, DIEMTHI)
	VALUES (@masv, @mamon, @diemthi)
END


-- ------CÂU 4


CREATE TRIGGER THEM_SUA
ON DIEM
FOR  INSERT, UPDATE
AS
IF(SELECT DIEMTHI FROM INSERTED)>10 AND (SELECT DIEMTHI FROM INSERTED)<0
BEGIN
PRINT
'KHONG CHO PHEP'
ROLLBACK TRANSACTION
END
INSERT INTO DIEM
VALUES ('SV01','A02','4')



 
 
 